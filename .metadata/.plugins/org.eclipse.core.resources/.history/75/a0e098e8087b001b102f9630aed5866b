package ftps;

import java.io.BufferedOutputStream;
import java.io.File;
import java.io.FileOutputStream;
import java.io.IOException;
import java.io.OutputStream;
import java.net.SocketException;

import org.apache.commons.net.ftp.FTPClient;
import org.apache.commons.net.ftp.FTPFile;
import org.apache.commons.net.ftp.FTPSClient;

public class main {
	
	private static void downloadFolder(String fileName, String downloadtarget, String downloadpath, FTPSClient ftpClient) {
		
		BufferedOutputStream outStream = null;
		try {
			ftpClient.changeWorkingDirectory(downloadtarget);
			FileOutputStream f = new FileOutputStream(downloadpath);
			outStream = new BufferedOutputStream(f);
			ftpClient.retrieveFile(fileName, outStream);
			
		} catch (IOException e) {
			// TODO Auto-generated catch block
			e.printStackTrace();
		} finally{
			if (null != outStream) {
				try {
				outStream.flush();
				outStream.close();
				}catch (IOException e) {
				e.printStackTrace();
				}
			}
		}
	}
	
	private static void downloadFolder(
		    FTPClient ftpClient, String remotePath, String localPath) throws IOException
		{
		    System.out.println("Downloading folder " + remotePath + " to " + localPath);

		    FTPFile[] remoteFiles = ftpClient.listFiles(remotePath);

		    for (FTPFile remoteFile : remoteFiles)
		    {
		        if (!remoteFile.getName().equals(".") && !remoteFile.getName().equals(".."))
		        {
		            String remoteFilePath = remotePath + "/" + remoteFile.getName();
		            String localFilePath = localPath + "/" + remoteFile.getName();

		            if (remoteFile.isDirectory())
		            {
		                new File(localFilePath).mkdirs();

		                downloadFolder(ftpClient, remoteFilePath, localFilePath);
		            }
		            else
		            {
		            	System.out.println("Downloading file " + remoteFilePath + " to " +
		                        localFilePath);

		                    OutputStream outputStream =
		                        new BufferedOutputStream(new FileOutputStream(localFilePath));
		                    if (!ftpClient.retrieveFile(remoteFilePath, outputStream))
		                    {
		                        System.out.println("Failed to download file " + remoteFilePath);
		                    }
		                    outputStream.close();
		                }
		            }
		        }
		    }	
		            
	
	public static void main(String[] args) {
		// TODO Auto-generated method stub

		String downloadtarget = "/";
		String downloadpath = "D:/temp";
		String fileName = "test";
		
		
		FTPSClient ftpClient = new FTPSClient();
		try {
			ftpClient.connect("10.253.46.177");
			ftpClient.login("client1", "c1234567890");
			System.out.println("connect");
		
			downloadFolder(ftpClient, downloadtarget, downloadpath);
			
		
			ftpClient.logout();
		} catch (SocketException e) {
			// TODO Auto-generated catch block
			e.printStackTrace();
		} catch (IOException e) {
			// TODO Auto-generated catch block
			e.printStackTrace();
		}
	}

}
